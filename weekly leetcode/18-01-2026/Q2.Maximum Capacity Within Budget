class Solution {
public:
    int maxCapacity(vector<int>& costs, vector<int>& capacity, int budget) {
        int n = costs.size();
        int ans = 0;
        vector<pair<int, int>> mp;
        for (int i = 0; i < n; i++) {
            mp.push_back({costs[i], capacity[i]});
        }
        sort(mp.begin(), mp.end());
        vector<int> temp(n);
        temp[0] = mp[0].second;
        for (int i = 1; i < n; i++) {
            temp[i] = max(temp[i - 1], mp[i].second);
        }

        // single machine hai toh
        for (int i = 0; i < n; i++) {
            if (mp[i].first < budget) {
                ans = max(ans, mp[i].second);
            }
        }

        // two machines hai toh
        for (int i = 1; i < n; i++) {
            int rem = budget - mp[i].first - 1;
            if (rem < 0) continue;

            int l = 0, r = i - 1, idx = -1;
            while (l <= r) {
                int mid = (l + r) / 2;
                if (mp[mid].first <= rem) {
                    idx = mid;
                    l = mid + 1;
                } else {
                    r = mid - 1;
                }
            }

            if (idx != -1) {
                int tc = mp[i].first + mp[idx].first;
                int tcap = mp[i].second + temp[idx];
                ans = max(ans, tcap);
            }
        }

        return ans;
    }
};
